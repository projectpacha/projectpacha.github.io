let typingTimer;const debounceDelay=300;function debouncedTransliterate(){clearTimeout(typingTimer),typingTimer=setTimeout(()=>{manglishToggle.checked&&transliterate()},debounceDelay)}function transliterate(){var e=searchInput.value,e=manglishToMalayalam(e);searchInput.value=e}async function searchDictionary(){var e,t=document.getElementById("searchInput").value.trim();t&&("headword"===(e=determineSearchType(t))?await searchHeadword(t):"sense"===e&&await searchSense(t))}async function searchHeadword(c){try{var e=await(await fetch("data.xml")).text();const i=(new DOMParser).parseFromString(e,"application/xml").getElementsByTagName("entry"),d=document.getElementById("results-container");d.innerHTML="";let r=!1,s=[],o=new Set;Array.from(i).forEach(e=>{var t=e.getElementsByTagName("headword")[0].textContent,n=e.getElementsByTagName("variation")[0]?.textContent||"",a=e.getElementsByTagName("pos")[0].textContent,e=Array.from(e.getElementsByTagName("sense")).map(e=>e.textContent);t===c||n===c?(r=!0,displayEntry(t,n,a,e,d),findRelatedWords(i,t,e,o)):(t.includes(c)||n.includes(c))&&s.push(t)}),r||(d.innerHTML="<p>No exact match found.</p>"),displayOtherMatches(s,d),displayRelatedWords(o,d)}catch(e){console.error("Error fetching or parsing XML:",e),document.getElementById("results-container").innerHTML="<p>Could not load data.</p>"}}async function searchSense(r){try{var e=await(await fetch("data.xml")).text(),t=(new DOMParser).parseFromString(e,"application/xml").getElementsByTagName("entry");const n=document.getElementById("results-container");n.innerHTML="";let a=[];Array.from(t).forEach(e=>{var t=e.getElementsByTagName("headword")[0].textContent,n=e.getElementsByTagName("pos")[0].textContent,e=Array.from(e.getElementsByTagName("sense")).map(e=>e.textContent);0<e.filter(e=>e.includes(r)).length&&a.push({headword:t,pos:n,senses:e})}),0===a.length?n.innerHTML="<p>No matches found.</p>":a.forEach(e=>displayEntry(e.headword,e.pos,e.senses,n))}catch(e){console.error("Error fetching or parsing XML:",e),document.getElementById("results-container").innerHTML="<p>Could not load data.</p>"}}function determineSearchType(e){return e.match(/^[a-zA-Z]+$/)?"sense":"headword"}function displayEntry(e,t,n,a,r){var s=document.createElement("div"),o=(s.classList.add("result"),transliterateToISO(e)),c=transliterateToISO(t);s.innerHTML=`
       <h3>${e}${t?` (${t})`:""}</h3>
         <p class="iso-transliteration">${o}${t?" | Variation: "+c:""}</p>
        <h4><strong></strong> ${n}</h4>
        <p><strong></strong> ${a.join(", ")}</p>
    `,r.appendChild(s)}function displayOtherMatches(e,t){if(0<e.length){const n=document.createElement("div");n.classList.add("other-matches"),n.innerHTML="<h4>other matches</h4>",e.forEach(t=>{var e=document.createElement("a");e.href="#",e.textContent=t,e.classList.add("match-link"),e.addEventListener("click",e=>{e.preventDefault(),document.getElementById("searchInput").value=t,searchDictionary()}),n.appendChild(e),n.appendChild(document.createElement("br"))}),t.appendChild(n)}}function displayRelatedWords(e,t){if(0<e.size){const n=document.createElement("div");n.classList.add("related-words"),n.innerHTML="<h4>Related Words:</h4>",e.forEach(t=>{var e=document.createElement("a");e.href="#",e.textContent=t,e.classList.add("related-link"),e.addEventListener("click",e=>{e.preventDefault(),document.getElementById("searchInput").value=t,searchDictionary()}),n.appendChild(e),n.appendChild(document.createElement("br"))}),t.appendChild(n)}}function findRelatedWords(e,n,a,r){Array.from(e).forEach(e=>{const t=e.getElementsByTagName("headword")[0].textContent;t!==n&&Array.from(e.getElementsByTagName("sense")).forEach(e=>{a.includes(e.textContent)&&!r.has(t)&&r.add(t)})})}function toggleHistory(){var e=document.getElementById("search-history");e.classList.contains("hidden")?showSearchHistory():e.classList.add("hidden")}function addSearchHistory(e){var t=JSON.parse(localStorage.getItem("searchHistory"))||[];t.includes(e)||(t.unshift(e),10<t.length&&t.pop(),localStorage.setItem("searchHistory",JSON.stringify(t)))}function showSearchHistory(){const n=document.getElementById("search-history");n.innerHTML="";var e=JSON.parse(localStorage.getItem("searchHistory"))||[];0===e.length?n.innerHTML='<p class="search-history-item">No search history</p>':e.forEach(e=>{var t=document.createElement("div");t.classList.add("search-history-item"),t.textContent=e,t.addEventListener("click",()=>{document.getElementById("searchInput").value=e,n.classList.add("hidden"),searchDictionary()}),n.appendChild(t)}),n.classList.remove("hidden")}document.getElementById("searchIcon").addEventListener("click",searchDictionary),document.getElementById("searchIcon").addEventListener("click",()=>{var e=document.getElementById("searchInput").value.trim();e&&(addSearchHistory(e),searchDictionary())}),document.getElementById("history-icon").addEventListener("click",toggleHistory),document.addEventListener("click",e=>{var t=document.getElementById("search-history");t.contains(e.target)||document.getElementById("history-icon").contains(e.target)||t.classList.add("hidden")});
